@Library('pritam-shared') _

pipeline {
    agent any
    parameters {
        string(name: 'URL', defaultValue: 'https://github.com/Pritam1705/Terraform_infra.git', description: 'Repository URL for checkout')
        string(name: 'WORKSPACE_DIR', defaultValue: '/var/lib/jenkins/workspace/pratice1/Terraform_infra', description: 'Workspace directory for Terraform')
    }
    stages {
        stage('Clean Workspace') {
            steps {
                cleanWs() 
            }
        }
        stage('Clone Role') {
            steps {
                script {
                    cloneRepo(params.URL) 
                }
            }
        }
        stage('Terraform Init') {
            steps {
                script {
                    init(this, params.WORKSPACE_DIR) // Use the parameterized workspace directory
                }
            }
        }
        stage('Terraform Validate') {
            steps {
                script {
                    validate(this, params.WORKSPACE_DIR) 
                }
            }
        }
        stage('Terraform Plan') {
            steps {
                script {
                    plan(this, params.WORKSPACE_DIR) 
                }
            }
        }
        stage('Terraform Apply') { 
            steps {
                script {
                    apply(this, params.WORKSPACE_DIR, true) 
                }
            }
        }
    }
}
